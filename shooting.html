<!DOCTYPE html>
<html>

<head>
	<title>Controling the camera - Example</title>
	<style>
        body {
          margin: 0;
          overflow: hidden;
        }
        canvas {
          display: block;
        }
		#start-button {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			padding: 20px 40px;
			font-size: 24px;
			font-weight: bold;
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 10px;
		}
      </style>
</head>

<body>
	<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <button id="startButton">Start Game</button>
    <div id="counter">0</div>

	<script type="importmap">
		{
    		"imports": {
     			 "three": "https://threejs.org/build/three.module.js"
    		}
  		}
	</script>

	<script type="module">

		import * as THREE from 'three';
    import {OrbitControls} from "./OrbitControls.js";

		// Set up the scene, camera, and renderer
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Set up an array of different shape geometries
  const geometries = [
    new THREE.BoxGeometry(1, 1, 1),
    new THREE.SphereGeometry(0.5, 16, 16),
    new THREE.ConeGeometry(0.5, 1, 16),
  ];

  // Set up an array of different colors
  const colors = [
    0xff0000, // Red
    0x00ff00, // Green
    0x0000ff, // Blue
    0xffff00, // Yellow
    0xff00ff, // Magenta
    0x00ffff, // Cyan
  ];

  // Variable to keep track of whether the game is running
  let gameRunning = false;

  // Counter for the number of shapes clicked
  let numShapesClicked = 0;

  // Counter for the number of shapes on the screen
  let numShapesOnScreen = 0;

  // Variable for the speed of shape spawning
  let spawnSpeed = 500;

  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  function onMouseClick( event ) {
    event.preventDefault();

    mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
    mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

    raycaster.setFromCamera( mouse, camera );

    const intersects = raycaster.intersectObjects( scene.children );

    if ( intersects.length > 0 ) {
      const object = intersects[ 0 ].object;

      if (object.visible) {
        object.visible = false;
        numShapesClicked += 10;
        updateCounter();
      }
    }
  }

  document.addEventListener( 'click', onMouseClick, false );

  // Function to start the game
  function startGame() {
    gameRunning = true;
    document.body.removeChild(startButton);
    spawnSpeed = 500;
    numShapesClicked = 0;
    numShapesOnScreen = 0;
    updateCounter();
    updateSpeedDisplay();
  }

  // Function to update the counter
  function updateCounter() {
    const counter = document.getElementById("counter");
    counter.innerText = "Score: " + numShapesClicked;
  }

  // Function to update the speed display
  function updateSpeedDisplay() {
    const speedDisplay = document.getElementById("speed");
    speedDisplay.innerText = "Spawn speed: " + spawnSpeed;
  }

  // Function to spawn a random shape object in a random position, size, and color
  function spawnShape() {
  if (gameRunning) {
    const geometry = geometries[Math.floor(Math.random() * geometries.length)];
    const material = new THREE.MeshBasicMaterial({ color: colors[Math.floor(Math.random() * colors.length)] });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.scale.set(Math.random() + 0.5, Math.random() + 0.5, Math.random() + 0.5);
    mesh.position.set(Math.random() * 10 - 5, Math.random() * 10 - 5, -10);
    scene.add(mesh);

    // Add a click event listener to remove the object when clicked
    mesh.addEventListener('click', function() {
      scene.remove(this);
      numShapesClicked += 10;
      updateCounter();
    });
    
    // Check if the score is greater than or equal to 200
    if (numShapesClicked >= 200) {
      // Decrease the interval to spawn shapes faster
      clearInterval(shapeInterval);
      shapeInterval = setInterval(spawnShape, 250);
    }

    // Increase the spawn speed every 20 points
    if (numShapesClicked % 50 === 0) {
          spawnSpeed -= 50;
          updateSpeedDisplay();
        }

    // Check if there are 10 shapes on the screen
    if (scene.children.length > 15) {
      // Stop the game and show the game over message
      gameRunning = false;
      const gameOverMsg = document.createElement('div');
      gameOverMsg.innerText = "Game over! Click the button to play again.";
      gameOverMsg.style.position = "absolute";
      gameOverMsg.style.top = "50%";
      gameOverMsg.style.left = "50%";
      gameOverMsg.style.transform = "translate(-50%, -50%)";
      gameOverMsg.style.color = "white";
      gameOverMsg.style.fontSize = "36px";
      document.body.appendChild(gameOverMsg);

      // Set the score to 0
      numShapesClicked = 0;
        }
      }
    }

  // Set up a timer to spawn a new shape every 0.5 seconds
  setInterval(spawnShape, spawnSpeed);

      // // Orbit Control definition 
      // const orbit = new OrbitControls(camera, renderer.domElement);
      // // limit vertical movement
      // orbit.minPolarAngle = orbit.maxPolarAngle = Math.PI / 2;

      // Set up the camera position and render loop
      camera.position.z = 5;
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
        //orbit.update(); // update the state of OrbitControls
      }

      let render = function () {

      renderer.render(scene, camera); //renders the scene

      window.addEventListener('resize', function() {
          renderer.setSize(window.innerWidth, window.innerHeight);
          camera.aspect = cam;
          camera.updateProjectionMatrix();
      })

      requestAnimationFrame(render);
      };

      render();

      // Set up the start button and click event listener
      const startButton = document.createElement('button');
      startButton.innerText = 'Start Game';
      startButton.addEventListener('click', startGame());
      document.body.appendChild(startButton);


      // Set up the counter
      const counter = document.createElement('div');
      counter.id = "counter";
      counter.style.position = "absolute";
      counter.style.top = "10px";
      counter.style.right = "10px";
      counter.style.color = "white";
      counter.style.fontSize = "24px";
      updateCounter();
      document.body.appendChild(counter);

      animate();


	</script>
</body>

</html>